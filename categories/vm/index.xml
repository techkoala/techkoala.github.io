<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
    <channel>
        <title>VM - 分类 - TechKoala - Input/Output</title>
        <link>https://www.techkoala.top/categories/vm/</link>
        <description>VM - 分类 - TechKoala - Input/Output</description>
        <generator>Hugo -- gohugo.io</generator><language>zh-CN</language><managingEditor>admin@techkoala.top (TechKoala)</managingEditor>
            <webMaster>admin@techkoala.top (TechKoala)</webMaster><copyright>This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.</copyright><lastBuildDate>Thu, 02 Sep 2021 11:25:59 &#43;0800</lastBuildDate><atom:link href="https://www.techkoala.top/categories/vm/" rel="self" type="application/rss+xml" /><item>
    <title>快速调整 Hyper-V 虚拟机磁盘大小</title>
    <link>https://www.techkoala.top/resize_vm_lvm_disk_size/</link>
    <pubDate>Thu, 02 Sep 2021 11:25:59 &#43;0800</pubDate><author>
        <name>TechKoala</name>
    </author><guid>https://www.techkoala.top/resize_vm_lvm_disk_size/</guid>
    <description><![CDATA[<blockquote>
<p>如何调整已建立的 Hyper-V 虚拟机磁盘大小？本文以 Ubuntu 为例，对此进行介绍。</p>
</blockquote>
<h2 id="说明">说明</h2>
<p>此教程适用于使用 LVM 格式化的任何 Ubuntu 文件系统。</p>
<p>如果你在使用 VMware，基本步骤与下面的教程类似，区别参见<a href="https://unix.stackexchange.com/questions/196512/how-to-extend-filesystem-partition-on-ubuntu-vm" target="_blank" rel="noopener noreffer">这里</a>。</p>
<h2 id="tldr">TL;DR</h2>
<ol>
<li>fdisk -l (note it’s partition 3 by looking at the current Size)</li>
<li>parted</li>
<li>resizepart, Fix, 3, 100% (type this instead), quit</li>
<li>pvresize /dev/sda3</li>
<li>lvextend -l +100%FREE /dev/mapper/ubuntu–vg-ubuntu–lv</li>
<li>resize2fs /dev/mapper/ubuntu–vg-ubuntu–lv</li>
<li>df -h</li>
</ol>
<h2 id="具体步骤">具体步骤</h2>
<h3 id="查看剩余磁盘大小">查看剩余磁盘大小</h3>
<p>在下面的输出中，请注意 /root 卷只有 3.9 GB 的磁盘空间：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">user@server:~$ df -h
Filesystem Size Used Avail Use% Mounted on
udev 1.9G <span class="m">0</span> 1.9G 0% /dev
tmpfs 394M 1.1M 393M 1% /run
/dev/mapper/ubuntu--vg-ubuntu--lv 3.9G 3.2G 489M 87% /
tmpfs 2.0G <span class="m">0</span> 2.0G 0% /dev/shm
tmpfs 5.0M <span class="m">0</span> 5.0M 0% /run/lock
tmpfs 2.0G <span class="m">0</span> 2.0G 0% /sys/fs/cgroup
/dev/loop0 89M 89M <span class="m">0</span> 100% /snap/core/7270
/dev/sda2 976M 77M 833M 9% /boot
/dev/loop1 90M 90M <span class="m">0</span> 100% /snap/core/7713
tmpfs 394M <span class="m">0</span> 394M 0% /run/user/1000
</code></pre></td></tr></table>
</div>
</div><p>接下来，在输出中可以看出实际上还有更多可用空间未利用。例如 /dev/sda3 卷上有 24G。另一个 1GB 用于启动卷和 BIOS 启动</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">user@server:~# fdisk -l
Disk /dev/loop0: 88.5 MiB, <span class="m">92778496</span> bytes, <span class="m">181208</span> sectors
Units: sectors of <span class="m">1</span> * <span class="nv">512</span> <span class="o">=</span> <span class="m">512</span> bytes
Sector size <span class="o">(</span>logical/physical<span class="o">)</span>: <span class="m">512</span> bytes / <span class="m">512</span> bytes
I/O size <span class="o">(</span>minimum/optimal<span class="o">)</span>: <span class="m">512</span> bytes / <span class="m">512</span> bytes


Disk /dev/loop1: <span class="m">89</span> MiB, <span class="m">93327360</span> bytes, <span class="m">182280</span> sectors
Units: sectors of <span class="m">1</span> * <span class="nv">512</span> <span class="o">=</span> <span class="m">512</span> bytes
Sector size <span class="o">(</span>logical/physical<span class="o">)</span>: <span class="m">512</span> bytes / <span class="m">512</span> bytes
I/O size <span class="o">(</span>minimum/optimal<span class="o">)</span>: <span class="m">512</span> bytes / <span class="m">512</span> bytes

...

Disk /dev/sda: <span class="m">25</span> GiB, <span class="m">26843545600</span> bytes, <span class="m">52428800</span> sectors
Units: sectors of <span class="m">1</span> * <span class="nv">512</span> <span class="o">=</span> <span class="m">512</span> bytes
Sector size <span class="o">(</span>logical/physical<span class="o">)</span>: <span class="m">512</span> bytes / <span class="m">4096</span> bytes
I/O size <span class="o">(</span>minimum/optimal<span class="o">)</span>: <span class="m">4096</span> bytes / <span class="m">4096</span> bytes
Disklabel type: gpt
Disk identifier: ED41F7A6-5D09-457B-A55C-C7F1E30DE419

Device Start End Sectors Size Type
/dev/sda1 <span class="m">2048</span> <span class="m">4095</span> <span class="m">2048</span> 1M BIOS boot
/dev/sda2 <span class="m">4096</span> <span class="m">2101247</span> <span class="m">2097152</span> 1G Linux filesystem
/dev/sda3 <span class="m">2101248</span> <span class="m">52426751</span> <span class="m">50325504</span> 24G Linux filesystem


Disk /dev/mapper/ubuntu--vg-ubuntu--lv: <span class="m">4</span> GiB, <span class="m">4294967296</span> bytes, <span class="m">8388608</span> sectors
Units: sectors of <span class="m">1</span> * <span class="nv">512</span> <span class="o">=</span> <span class="m">512</span> bytes
Sector size <span class="o">(</span>logical/physical<span class="o">)</span>: <span class="m">512</span> bytes / <span class="m">4096</span> bytes
I/O size <span class="o">(</span>minimum/optimal<span class="o">)</span>: <span class="m">4096</span> bytes / <span class="m">4096</span> bytes
</code></pre></td></tr></table>
</div>
</div><h3 id="调整虚拟机磁盘大小">调整虚拟机磁盘大小</h3>
<p>进入 Hyper-V 虚拟机设置界面，编辑硬盘驱动器，然后对此进行扩容，此后重启虚拟机。</p>
<h3 id="重新分区">重新分区</h3>
<p>下面利用 parted 进行对新加的磁盘进行分区。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">user@server:~# parted
GNU Parted 3.2
Using /dev/sda
Welcome to GNU Parted! Type <span class="s1">&#39;help&#39;</span> to view a list of commands.
<span class="o">(</span>parted<span class="o">)</span> print
Model: Msft Virtual Disk <span class="o">(</span>scsi<span class="o">)</span>
Disk /dev/sda: 26.8GB
Sector size <span class="o">(</span>logical/physical<span class="o">)</span>: 512B/4096B
Partition Table: gpt
Disk Flags:

Number Start End Size File system Name Flags
<span class="m">1</span> 1049kB 2097kB 1049kB bios_grub
<span class="m">2</span> 2097kB 1076MB 1074MB ext4
<span class="m">3</span> 1076MB 26.8GB 25.8GB

<span class="o">(</span>parted<span class="o">)</span> quit
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">user@server:~# parted
GNU Parted 3.2
Using /dev/sda
Welcome to GNU Parted! Type <span class="s1">&#39;help&#39;</span> to view a list of commands.
<span class="o">(</span>parted<span class="o">)</span> resizepart
Partition number? <span class="m">3</span>
End? <span class="o">[</span>26.8GB<span class="o">]</span>?
<span class="o">(</span>parted<span class="o">)</span> quit
Information: You may need to update /etc/fstab.
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">user@server:~# pvresize /dev/sda3
Physical volume <span class="s2">&#34;/dev/sda3&#34;</span> changed
<span class="m">1</span> physical volume<span class="o">(</span>s<span class="o">)</span> resized / <span class="m">0</span> physical volume<span class="o">(</span>s<span class="o">)</span> not resized
</code></pre></td></tr></table>
</div>
</div><h3 id="扩容">扩容</h3>
<p>接下来，对 LVM 虚拟磁盘进行扩容。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">user@server:~# resize2fs /dev/mapper/ubuntu--vg-ubuntu--lv
resize2fs 1.44.1 <span class="o">(</span>24-Mar-2018<span class="o">)</span>
Filesystem at /dev/mapper/ubuntu--vg-ubuntu--lv is mounted on /<span class="p">;</span> on-line resizing required
<span class="nv">old_desc_blocks</span> <span class="o">=</span> 1, <span class="nv">new_desc_blocks</span> <span class="o">=</span> <span class="m">3</span>
The filesystem on /dev/mapper/ubuntu--vg-ubuntu--lv is now <span class="m">6029312</span> <span class="o">(</span>4k<span class="o">)</span> blocks long.
</code></pre></td></tr></table>
</div>
</div><h3 id="确认">确认</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">user@server:~# df -h
Filesystem Size Used Avail Use% Mounted on
udev 1.9G <span class="m">0</span> 1.9G 0% /dev
tmpfs 394M 1.1M 393M 1% /run
/dev/mapper/ubuntu--vg-ubuntu--lv 23G 3.2G 19G 15% /
tmpfs 2.0G <span class="m">0</span> 2.0G 0% /dev/shm
tmpfs 5.0M <span class="m">0</span> 5.0M 0% /run/lock
tmpfs 2.0G <span class="m">0</span> 2.0G 0% /sys/fs/cgroup
/dev/loop0 89M 89M <span class="m">0</span> 100% /snap/core/7270
/dev/sda2 976M 77M 833M 9% /boot
/dev/loop1 90M 90M <span class="m">0</span> 100% /snap/core/7713
tmpfs 394M <span class="m">0</span> 394M 0% /run/user/1000
user@server:~#
</code></pre></td></tr></table>
</div>
</div><h2 id="参考">参考</h2>
<ul>
<li>[1] <a href="https://vander.host/knowledgebase/operating-systems/how-to-resize-an-ubuntu-18-04-lvm-disk/" target="_blank" rel="noopener noreffer">How to resize an Ubuntu 18.04/20.04 LVM disk</a></li>
</ul>]]></description>
</item><item>
    <title>Hyper-V 桥接网络</title>
    <link>https://www.techkoala.top/hyper-v_bridging/</link>
    <pubDate>Wed, 20 May 2020 15:30:24 &#43;0800</pubDate><author>
        <name>TechKoala</name>
    </author><guid>https://www.techkoala.top/hyper-v_bridging/</guid>
    <description><![CDATA[<blockquote>
<p>Hyper-V 桥接模式</p>
</blockquote>
<p>Hyper-V 没有 VM 的桥接模式可以选择，为了让虚拟机可以和宿主机同网段，需要搭建网桥。</p>
<p>创建网桥的步骤如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">操作 -&gt; 虚拟交换机管理器 -&gt; 新建虚拟网络交换机 -&gt; 选择外部类型 -&gt; 创建虚拟交换机 -&gt; 设置连接类型为内部网络 -&gt; 应用
</code></pre></td></tr></table>
</div>
</div><p>首先点击虚拟机右边的 Hyper-V 操作选项<code>虚拟交换机管理器</code>：</p>
<figure><a class="lightgallery" href="https://fastly.jsdelivr.net/gh/techkoala/techkoala.github.io@master/images/VM/Hyper-v_Bridging/hyperv-1.webp" title="https://fastly.jsdelivr.net/gh/techkoala/techkoala.github.io@master/images/VM/Hyper-v_Bridging/hyperv-1.webp" data-thumbnail="https://fastly.jsdelivr.net/gh/techkoala/techkoala.github.io@master/images/VM/Hyper-v_Bridging/hyperv-1.webp" data-sub-html="<h2>网络拓扑图</h2>">
        
    </a><figcaption class="image-caption">网络拓扑图</figcaption>
    </figure>
<p>新建虚拟交换机：</p>
<figure><a class="lightgallery" href="https://fastly.jsdelivr.net/gh/techkoala/techkoala.github.io@master/images/VM/Hyper-v_Bridging/hyperv-2.webp" title="https://fastly.jsdelivr.net/gh/techkoala/techkoala.github.io@master/images/VM/Hyper-v_Bridging/hyperv-2.webp" data-thumbnail="https://fastly.jsdelivr.net/gh/techkoala/techkoala.github.io@master/images/VM/Hyper-v_Bridging/hyperv-2.webp" data-sub-html="<h2>网络拓扑图</h2>">
        
    </a><figcaption class="image-caption">网络拓扑图</figcaption>
    </figure>
<p>将主机的网络和虚拟网络进行桥接：</p>
<figure><a class="lightgallery" href="https://fastly.jsdelivr.net/gh/techkoala/techkoala.github.io@master/images/VM/Hyper-v_Bridging/hyperv-3.webp" title="https://fastly.jsdelivr.net/gh/techkoala/techkoala.github.io@master/images/VM/Hyper-v_Bridging/hyperv-3.webp" data-thumbnail="https://fastly.jsdelivr.net/gh/techkoala/techkoala.github.io@master/images/VM/Hyper-v_Bridging/hyperv-3.webp" data-sub-html="<h2>网络拓扑图</h2>">
        
    </a><figcaption class="image-caption">网络拓扑图</figcaption>
    </figure>
<p>设置虚拟机的 IP 与宿主机的 IP 为同一网段，方便进行连接。</p>]]></description>
</item><item>
    <title>PVE 安装 Q&amp;A</title>
    <link>https://www.techkoala.top/pve_q_a/</link>
    <pubDate>Tue, 19 May 2020 15:31:34 &#43;0800</pubDate><author>
        <name>TechKoala</name>
    </author><guid>https://www.techkoala.top/pve_q_a/</guid>
    <description><![CDATA[<blockquote>
<p>PVE 安装过程中遇到的问题以及解决方法</p>
</blockquote>
<h1 id="pve-安装-qa">PVE 安装 Q&amp;A</h1>
<p>近期将家里的服务器从 <code>Hyper-V</code> 迁移到 <code>PVE</code> 上。</p>
<p>目前安装有<code>黑群晖</code>、<code>Openwrt</code>、<code>Ubuntu 18.09LTS</code></p>
<p>目前的网络拓扑图如下：</p>
<figure><a class="lightgallery" href="https://fastly.jsdelivr.net/gh/techkoala/techkoala.github.io@master/images/VM/PVE/%e6%8b%93%e6%89%91.png" title="https://fastly.jsdelivr.net/gh/techkoala/techkoala.github.io@master/images/VM/PVE/拓扑.png" data-thumbnail="https://fastly.jsdelivr.net/gh/techkoala/techkoala.github.io@master/images/VM/PVE/拓扑.png" data-sub-html="<h2>网络拓扑图</h2>">
        
    </a><figcaption class="image-caption">网络拓扑图</figcaption>
    </figure>
<p>将安装过程中遇到的问题以及解决方法整理如下：</p>
<h3 id="1-temporary-failure-in-name-resolution">1. Temporary failure in name resolution：</h3>
<p>由于开始使用路由器拨号，因此初次安装设置的 <code>DNS</code> 服务器为路由器地址，安装软路由后更改了地址，所以导致 <code>DNS</code> 服务器设置错误 192.168.1.190 &gt; 192.168.1.1</p>
<h3 id="2-群晖挂载硬盘">2. 群晖挂载硬盘：</h3>
<p><code>PVE</code> 正确识别到了 <code>NTFS</code> 的一硬盘，但是群晖不能自动挂载。需要关机后，在 <code>PVE</code> 虚拟机管理界面，添加，然后重启才能识别。(否则显示为红色，同样的，移除硬件需要同样的操作)</p>
<h3 id="3-pve-节点监视图不显示时间为-1970-1-1">3. PVE 节点监视图不显示，时间为 1970-1-1：</h3>
<p>删除界面缓存文件即可：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Shell" data-lang="Shell">$ rm /var/lib/rrdcached/db/pve2-node
</code></pre></td></tr></table>
</div>
</div><h3 id="4-群晖-socks-代理">4. 群晖 socks 代理</h3>
<p>Openwrt 安装 luci-app-Privoxy，设置转发规则：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-Shell" data-lang="Shell">$ /ip:port .
</code></pre></td></tr></table>
</div>
</div>]]></description>
</item><item>
    <title>Virtualbox 共享文件夹权限问题</title>
    <link>https://www.techkoala.top/virtualbox_file_share_issue/</link>
    <pubDate>Wed, 10 Oct 2018 13:26:54 &#43;0800</pubDate><author>
        <name>TechKoala</name>
    </author><guid>https://www.techkoala.top/virtualbox_file_share_issue/</guid>
    <description><![CDATA[<blockquote>
<p>一行命令解决 Virtualbox 共享文件夹权限问题</p>
</blockquote>
<h2 id="功能">功能</h2>
<p>使用 virtualbox 最方便的 <code>host-guest</code> 交换文件方案莫过于共享文件夹功能了。</p>
<p>比如 <code>host</code> 有个叫 <code>git</code> 的文件夹，可以直接将此文件夹设置为共享文件夹并自动 <code>mount</code>，这样，每次在虚拟机一开机就看到这个文件夹被挂载为<code>/media/sf_git</code>。</p>
<h2 id="问题">问题</h2>
<p>但是，在用非 <code>root</code> 用户方法这个文件夹时却会遇到权限不足问题。</p>
<p>原因在于自动 <code>mount</code> 的文件夹的所有者为 <code>root</code>，所属的组是 <code>vboxsf</code>，因此只有这两个用户有访问权限。</p>
<h2 id="解决">解决</h2>
<p>解决办法很简单，只需要将当前登录用户加入到 <code>vboxsf</code> 组就行了。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">sudo usermod -aG vboxsf <span class="k">$(</span>whoami<span class="k">)</span>
</code></pre></td></tr></table>
</div>
</div><p>重启一次系统组设置即生效。</p>]]></description>
</item></channel>
</rss>
